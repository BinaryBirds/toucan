<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to store keys in env files? - </title>
    <meta name="description" content="In this tutorial I&#39;ll show you how to save and load secret keys as base64 encoded strings using dotenv files in Vapor 4.">
    
    <meta property="og:url" content="/posts/how-to-store-keys-in-env-files/">
    <meta property="og:title" content="How to store keys in env files? - ">
    <meta property="og:description" content="In this tutorial I&#39;ll show you how to save and load secret keys as base64 encoded strings using dotenv files in Vapor 4.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to store keys in env files? - ">
    <meta name="twitter:description" content="In this tutorial I&#39;ll show you how to save and load secret keys as base64 encoded strings using dotenv files in Vapor 4.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2020-06-30 16:20:00">2020-06-30 16:20:00</time>
            <h1 class="title">How to store keys in env files?</h1>
            <p class="excerpt">In this tutorial I&#39;ll show you how to save and load secret keys as base64 encoded strings using dotenv files in Vapor 4.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>Using the Environment in Vapor 4</h2><p>Just like many popular server side frameworks, your Vapor based backend application can load a file called <code>.env</code>. It is possible to store key-value based (secret) configuration values inside this file. When you run the app, one of the following file will be loaded, based on the current environment:</p><ul><li>Production (`.env`)</li><li>Development (`.env.development`)</li><li>Testing (`.env.testing`)</li></ul><p>When you execute your tests the <code>.env.testing</code> file will be used. If you start the app using the <code>serve</code> Vapor <a href="https://theswiftdev.com/the-anatomy-of-vapor-commands/" target="_blank">command</a> you can also change the environment using the <code>--env</code> or <code>-e</code> flag. The available options are production and development, and the corresponding <code>.env</code> file will be loaded. It is possible to create a custom environment, you can read more about this in the <a href="https://docs.vapor.codes/4.0/environment/" target="_blank">official Vapor docs</a>. The .env file usually contains one key and value per line, now the problem starts when you want to store a multiline secret key in the file. So what can we do about this? ü§î</p><h2>Base64 encoded secret keys</h2><p>Yes, we can encode the secret key using a base64 encoding. No, I don‚Äôt want to copy my secrets into an <a href="https://www.base64encode.org/" target="_blank">online base64 encoder</a>, because there is a pretty simple shell command that I can use.</p><pre><code class="language-sh">echo "<my-secret-key>" | base64
</code></pre><p>If you don‚Äôt like unix commands, we can always put together a little Swift script and use an extension on the String type to encode keys. Just save the snippet from below into a base64.swift file, put your key into the key section, give the file some executable permission & run it using the <code>chmod o+x && ./base64.swift</code> one-liner command and voil√°‚Ä¶</p><pre><code class="language-swift">#! /usr/bin/swift

import Foundation

extension String {

    func base64Encoded() -> String? {
        return data(using: .utf8)?.base64EncodedString()
    }
}

let key = """
    <my-secret-key-comes-here>
"""

print(key.base64Encoded()!)
</code></pre><p>You can copy & paste the encoded value of the secret key into your own <code>.env.*</code> file, replace the asterix symbol with your current environment of course, before you do it. üôà</p><pre><code class="language-sh">//e.g. .env.development
SECRET_KEY="<base64-encoded-secret-key>"
</code></pre><p>Now we just have to decode this key somehow, before we can start using it‚Ä¶</p><h2>Decoding the secret key</h2><p>You can implement a base64 decoder as a String extension with just a few lines of Swift code.</p><pre><code class="language-swift">import Foundation

extension String {

    func base64Decoded() -> String? {
        guard let data = Data(base64Encoded: self) else { return nil }
        return String(data: data, encoding: .utf8)
    }
}
</code></pre><p>Now in my projects I like to extend the <code>Environment</code> object and place all my custom variables there as static constants, this way I can access them in a really convenient way, plus if something goes wrong (usually when I don‚Äôt re-create the <code>.env</code> file after a <code>git reset</code> or I don‚Äôt have all the variables present in the dotenv file) the app will crash because of the forced unwraps, and I‚Äôll know for sure that something is wrong with my environment. It‚Äôs a crash for my own safety. üí•</p><pre><code class="language-swift">import Vapor

extension Environment {
    static let secretKey = Self.get("SECRET_KEY")!.base64Decoded()!
}

// usage:
Environment.secretKey
</code></pre><p>I think this approach is very useful. Of course you should place the <code>.env.*</code> pattern into your <code>.gitignore</code> file, otherwise if you place some secrets into the dotenv file and you push that into the remote‚Ä¶ well, everyone else will know your keys, passwords, etc. You don‚Äôt want that, right? ‚ö†Ô∏è</p><p>Feel free to use this method when you have to implement a <a href="https://theswiftdev.com/sign-in-with-apple-using-vapor-4/" target="_blank">Sign in With Apple</a> workflow, or a Apple Push Notification service (APNs). In those cases you‚Äôll definitely have to pass one ore more secret keys to your Vapor based backend application. That‚Äôs it for now, thanks for reading.</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
