<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to build macOS apps using only the Swift Package Manager? - </title>
    <meta name="description" content="In this article we&#39;re going to create a macOS application without ever touching an Xcode project file, but only working with SPM.">
    
    <meta property="og:url" content="/posts/how-to-build-macos-apps-using-only-the-swift-package-manager/">
    <meta property="og:title" content="How to build macOS apps using only the Swift Package Manager? - ">
    <meta property="og:description" content="In this article we&#39;re going to create a macOS application without ever touching an Xcode project file, but only working with SPM.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to build macOS apps using only the Swift Package Manager? - ">
    <meta name="twitter:description" content="In this article we&#39;re going to create a macOS application without ever touching an Xcode project file, but only working with SPM.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2020-10-26 16:20:00">2020-10-26 16:20:00</time>
            <h1 class="title">How to build macOS apps using only the Swift Package Manager?</h1>
            <p class="excerpt">In this article we&#39;re going to create a macOS application without ever touching an Xcode project file, but only working with SPM.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>Swift scripts and macOS apps</h2><p>Swift compiler 101, you can create, build and run a Swift file using the <code>swiftc</code> command. Consider the most simple Swift program that we can all imagine in a <code>main.swift</code> file:</p><pre><code class="language-swift">print("Hello world!")
</code></pre><p>In Swift if we want to print something, we don‚Äôt even have to import the Foundation framework, we can simply compile and run this piece of code by running the following:</p><pre><code class="language-sh">swiftc main.swift   # compile main.swift
chmod +x main       # add the executable permission
./main          # run the binary
</code></pre><p>The good news that we can take this one step further by auto-invoking the Swift compiler under the hood with a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)" target="_blank">shebang</a>.</p><pre><code class="language-swift">#! /usr/bin/swift

print("Hello world!")
</code></pre><p>Now if you simply run the <code>./main.swift</code> file it‚Äôll print out the famous ‚ÄúHello world!‚Äù text. üëã</p><p>Thanks to the program-loader mechanism and of course the Swift interpreter we can skip an extra step and run our single-source Swift code as easy as a regular shell script. The good news is that we can import all sort of system frameworks that are part of the Swift toolchain. With the help of Foundation we can build quite useful or completely useless command line utilities.</p><pre><code class="language-swift">#!/usr/bin/env swift

import Foundation
import Dispatch

guard CommandLine.arguments.count == 2 else {
    fatalError("Invalid arguments")
}
let urlString =  CommandLine.arguments[1]
guard let url = URL(string: urlString) else {
    fatalError("Invalid URL")   
}

struct Todo: Codable {
    let title: String
    let completed: Bool
}

let task = URLSession.shared.dataTask(with: url) { data, response, error in 
    if let error = error {
        fatalError("Error: \(error.localizedDescription)")
    }
    guard let response = response as? HTTPURLResponse, response.statusCode == 200 else {
        fatalError("Error: invalid HTTP response code")
    }
    guard let data = data else {
        fatalError("Error: missing response data")
    }

    do {
        let decoder = JSONDecoder()
        let todos = try decoder.decode([Todo].self, from: data)
        print("List of todos:")
        print(todos.map { " - [" + ($0.completed ? "‚úÖ" : "‚ùå") + "] \($0.title)" }.joined(separator: "\n"))
        exit(0)
    }
    catch {
        fatalError("Error: \(error.localizedDescription)")
    }
}
task.resume()
dispatchMain()
</code></pre><p>If you call this example with a URL that can return a list of todos it‚Äôll print a nice list of the items.</p><pre><code class="language-sh">./main.swift https://jsonplaceholder.typicode.com/todos
</code></pre><p>Yes, you can say that this script is completely useless, but in my opinion it‚Äôs an amazing demo app, since it covers how to check command line arguments (<code>CommandLine.arguments</code>), it also shows you how to wait (<code>dispatchMain</code>) for an async task, such as a HTTP call through the network using the <a href="https://theswiftdev.com/urlsession-and-the-combine-framework/" target="_blank">URLSession API</a> to finish and exit using the right method when something fails (<code>fatalError</code>) or if you reach the end of execution (<code>exit(0)</code>). Just a few lines of code, but it contains so much info.</p><blockquote><p>NOTE: Have you noticed the new shebang? If you have multiple Swift versions installed on your system, you can use the <a href="https://unix.stackexchange.com/questions/29608/why-is-it-better-to-use-usr-bin-env-name-instead-of-path-to-name-as-my/29620#29620" target="_blank">env shebang</a> to go with the first one that‚Äôs available in your PATH.</p></blockquote><p>It‚Äôs not just Foundation, but you can import AppKit or even SwiftUI. Well, not under Linux of course, since those frameworks are only available for macOS plus you will need Xcode installed on your system, since some stuff in Swift the toolchain is still tied to the IDE, but why? üò¢</p><p>Anyway, back to the topic, here‚Äôs the boilerplate code for a macOS application Swift script that can be started from the Terminal with one simple <code>./main.swift</code> command and nothing more.</p><pre><code class="language-swift">#!/usr/bin/env swift

import AppKit
import SwiftUI

@available(macOS 10.15, *)
struct HelloView: View {
    var body: some View {
        Text("Hello world!")
    }
}

@available(macOS 10.15, *)
class WindowDelegate: NSObject, NSWindowDelegate {

    func windowWillClose(_ notification: Notification) {
        NSApplication.shared.terminate(0)
    }
}


@available(macOS 10.15, *)
class AppDelegate: NSObject, NSApplicationDelegate {
    let window = NSWindow()
    let windowDelegate = WindowDelegate()

    func applicationDidFinishLaunching(_ notification: Notification) {
        let appMenu = NSMenuItem()
        appMenu.submenu = NSMenu()
        appMenu.submenu?.addItem(NSMenuItem(title: "Quit", action: #selector(NSApplication.terminate(_:)), keyEquivalent: "q"))
        let mainMenu = NSMenu(title: "My Swift Script")
        mainMenu.addItem(appMenu)
        NSApplication.shared.mainMenu = mainMenu
        
        let size = CGSize(width: 480, height: 270)
        window.setContentSize(size)
        window.styleMask = [.closable, .miniaturizable, .resizable, .titled]
        window.delegate = windowDelegate
        window.title = "My Swift Script"

        let view = NSHostingView(rootView: HelloView())
        view.frame = CGRect(origin: .zero, size: size)
        view.autoresizingMask = [.height, .width]
        window.contentView!.addSubview(view)
        window.center()
        window.makeKeyAndOrderFront(window)
        
        NSApp.setActivationPolicy(.regular)
        NSApp.activate(ignoringOtherApps: true)
    }
}

let app = NSApplication.shared
let delegate = AppDelegate()
app.delegate = delegate
app.run()
</code></pre><p>Special thanks goes to <a href="https://github.com/karwa" target="_blank">karwa</a> for the <a href="https://gist.github.com/karwa/5207e232ac9ec53f0276252ab5e3ee07" target="_blank">original gist</a>. Also if you are into Storyboard-less macOS app development, you should definitely take a look at <a href="https://kicsipixel.github.io/2020/nostoryboard/" target="_blank">this article</a> by <a href="https://x.com/kicsipixel" target="_blank">@kicsipixel</a>. These resources helped me a lot to put together what I needed. I still had to extend the gist with a proper menu setup and the activation policy, but now this version acts like a real-world macOS application that works like a charm. There is only one issue here‚Ä¶ the script file is getting crowded. üôà</p><h2>Swift Package Manager and macOS apps</h2><p>So, if we follow the same logic, that means we can build an executable package that can invoke AppKit related stuff using the Swift Package Manager. Easy as a pie. ü•ß</p><pre><code class="language-sh">mkdir MyApp
cd MyApp 
swift package init --type=executable
</code></pre><p>Now we can separate the components into standalone files, we can also remove the availability checking, since we‚Äôre going to add a platform constraint using our <code>Package.swift</code> manifest file. If you don‚Äôt know much about how the Swift Package Manager works, please read <a href="https://theswiftdev.com/swift-package-manager-tutorial/" target="_blank">my SPM tutorial</a>, or if you are simply curious about the structure of a Package.swift file, you can read my article about the <a href="https://theswiftdev.com/the-swift-package-manifest-file/" target="_blank">Swift Package manifest file</a>. Let‚Äôs start with the manifest updates.</p><pre><code class="language-swift">// swift-tools-version:5.3
import PackageDescription

let package = Package(
    name: "MyApp",
    platforms: [
        .macOS(.v10_15)
    ],
    dependencies: [
        // .package(url: /* package url */, from: "1.0.0"),
    ],
    targets: [
        .target(name: "MyApp", dependencies: []),
        .testTarget(name: "MyAppTests", dependencies: ["MyApp"]),
    ]
)
</code></pre><p>Now we can place the HelloView struct into a new HelloView.swift file.</p><pre><code class="language-swift">import SwiftUI

struct HelloView: View {
    var body: some View {
        Text("Hello world!")
    }
}
</code></pre><p>The window delegate can have its own place inside a WindowDelegate.swift file.</p><pre><code class="language-swift">import AppKit

class WindowDelegate: NSObject, NSWindowDelegate {

    func windowWillClose(_ notification: Notification) {
        NSApplication.shared.terminate(0)
    }
}
</code></pre><p>We can apply the same thing to the AppDelegate class.</p><pre><code class="language-swift">import AppKit
import SwiftUI

class AppDelegate: NSObject, NSApplicationDelegate {
    let window = NSWindow()
    let windowDelegate = WindowDelegate()

    func applicationDidFinishLaunching(_ notification: Notification) {
        let appMenu = NSMenuItem()
        appMenu.submenu = NSMenu()
        appMenu.submenu?.addItem(NSMenuItem(title: "Quit", action: #selector(NSApplication.terminate(_:)), keyEquivalent: "q"))
        let mainMenu = NSMenu(title: "My Swift Script")
        mainMenu.addItem(appMenu)
        NSApplication.shared.mainMenu = mainMenu
        
        let size = CGSize(width: 480, height: 270)
        window.setContentSize(size)
        window.styleMask = [.closable, .miniaturizable, .resizable, .titled]
        window.delegate = windowDelegate
        window.title = "My Swift Script"

        let view = NSHostingView(rootView: HelloView())
        view.frame = CGRect(origin: .zero, size: size)
        view.autoresizingMask = [.height, .width]
        window.contentView!.addSubview(view)
        window.center()
        window.makeKeyAndOrderFront(window)
        
        NSApp.setActivationPolicy(.regular)
        NSApp.activate(ignoringOtherApps: true)
    }
}
</code></pre><p>Finally we can update the main.swift file and initiate everything that needs to be done.</p><pre><code class="language-swift">import AppKit

let app = NSApplication.shared
let delegate = AppDelegate()
app.delegate = delegate
app.run()
</code></pre><p>The good news is that this approach works, so you can develop, build and run apps locally, but unfortunately you can‚Äôt submit them to the Mac App Store, since the final application package won‚Äôt look like a real macOS bundle. The binary is not code signed, plus you‚Äôll need a real macOS target in Xcode to submit the application. Then why bother with this approach?</p><p>Well, just because it is fun and I can even avoid using Xcode with the help of <a href="https://github.com/apple/sourcekit-lsp" target="_blank">SourceKit-LSP</a> and some <a href="https://github.com/apple/sourcekit-lsp/tree/main/Editors" target="_blank">Editor configuration</a>. The best part is that SourceKit-LSP is now <a href="https://vercantez.com/posts/Writing-Swift-in-Sublime/" target="_blank">part of Xcode</a>, so you don‚Äôt have to install anything special, just configure your favorite IDE and start coding.</p><p>You can also <a href="https://developer.apple.com/documentation/swift_packages/bundling_resources_with_a_swift_package" target="_blank">bundle resources</a>, since this feature is available from Swift 5.3, and use them through the <code>Bundle.module</code> variable if needed. I already tried this, works pretty well, and it is so much fun to develop apps for the mac without the extra overhead that Xcode comes with. ü•≥</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
