<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Swift Package Manager tutorial - </title>
    <meta name="description" content="Learn how to use the Swift Package Manager to handle external dependencies, create your library or app on macOS and Linux.">
    
    <meta property="og:url" content="/posts/swift-package-manager-tutorial/">
    <meta property="og:title" content="Swift Package Manager tutorial - ">
    <meta property="og:description" content="Learn how to use the Swift Package Manager to handle external dependencies, create your library or app on macOS and Linux.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Swift Package Manager tutorial - ">
    <meta name="twitter:description" content="Learn how to use the Swift Package Manager to handle external dependencies, create your library or app on macOS and Linux.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/about/">About</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2017-11-19 16:20:00">2017-11-19 16:20:00</time>
            <h1 class="title">Swift Package Manager tutorial</h1>
            <p class="excerpt">Learn how to use the Swift Package Manager to handle external dependencies, create your library or app on macOS and Linux.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>Swift Package Manager basics</h2><p>First of all, please check your Swift version on your device before we jump in this tutorial will only work with the latest toolchain, so youâ€™ll need Swift 5.2 or newer.</p><pre><code>Apple Swift version 5.2.2 (swiftlang-1103.0.32.6 clang-1103.0.32.51)
Target: x86_64-apple-darwin19.4.0
</code></pre><h3>Creating apps</h3><p>All the hard work is done by the <code>swift package</code> command. You can enter that into a terminal window and see the available <a href="https://github.com/apple/swift-package-manager/blob/master/Documentation/Usage.md" target="_blank">sub-commands</a>. To generate a new package you should go with the init command, if you donâ€™t provide a type flag, by default itâ€™ll create a library, but this time weâ€™d like to make an executable application.</p><pre><code>swift package init --type executable
swift build
swift run my-app
</code></pre><p>The compiler can build your source files with the help of the swift build command. The executable file is going to be placed somewhere under the <code>.build</code> directory, if you run the newly created application with the swift run my-app command, you should see the basic <code>Hello, world!</code> message.</p><blockquote><p>Congratulations for your first command line Swift application!</p></blockquote><p>Now you should do some actual coding. Usually your swift source files should be under the Sources directory, however you might want to create some reusable parts for your app. So letâ€™s prepare for that scenario by starting a brand new library.</p><h3>Making a library</h3><p>We start with the <code>init</code> command, but this time we donâ€™t specify the type. We actually could enter <code>swift package init --type library</code> but thatâ€™s way too may words to type. Also because weâ€™re making a library, the SPM tool is going to provide us some basic tests, letâ€™s run them too with the <code>swift test</code> command. ðŸ˜œ</p><pre><code>swift package init
swift test
# swift test --help
# swift test --filter <test-target>.<test-case>/<test>
</code></pre><p>If you check the file structure now you wonâ€™t find a <code>main.swift</code> file inside the source folder, but instead of this youâ€™ll get an example unit test under the <code>Tests</code> directory.</p><p>Now know the basics. You have an example application and a library, so letâ€™s connect them together with the help of the Swift Package Manager Manifest API!</p><h2>The Manifest API - Package.swift</h2><p>Every SPM bundle has a Package.swift manifest file inside of it. In this manifest file you can define all your dependencies, targets and even the exact source files for your project. In this section Iâ€™ll teach you the basics of the manifest file.</p><h3>Tool version</h3><p>First of all if you want to support the new manifest file format (aka. Swift 4 version), you have to set the swift-tools-version as comment in your manifest file.</p><pre><code>// swift-tools-version:5.2
</code></pre><p>Now youâ€™re ready to work with the brand new manifest API.</p><h3>Dependencies</h3><p>Letâ€™s just add our library as a dependency for the main application first by creating a new package dependency inside the Package.swift file. The first argument is a package url string, which can be a local file path or a remote url (usually a github repo link). Note that you should add your dependency to the targets as well. Usually the specific name of a package is defined inside the library manifest file.</p><pre><code class="language-swift">// swift-tools-version:5.2
import PackageDescription

let package = Package(
    name: "my-app",
    dependencies: [
        .package(url: "../my-lib", .branch("master")),
    ],
    targets: [
        .target(name: "my-app", dependencies: [
            .product(name: "my-lib", package: "my-lib"),
        ]),
    ]
)
</code></pre><p>Now if you run <code>swift build</code> youâ€™ll fail to build your sources. Thatâ€™s because the SPM only works with git repositories. This means you have to create a repository for your library. Letâ€™s move to the directory of the library and run the following commands.</p><pre><code>git init
git add .
git commit -m 'initial'
</code></pre><p>You should also note that we specified the branch in the package dependencies. You can use version numbers, or even commit hashes too. All the available options are well written inside the <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0158-package-manager-manifest-api-redesign.md" target="_blank">manifest API redesign proposal</a> document.</p><p>Now letâ€™s go back to the application directory and update the dependencies with the <code>swift package update</code> command. This time itâ€™s going to be able to fetch, clone and finally resolve our dependency.</p><p>You can build and run, however weâ€™ve forgot to set the access level of our struct inside our library to public, so nothing is going to be visible from that API.</p><pre><code>public struct my_lib {
    public var text = "Hello, World!"

    public init() {}
}
</code></pre><p>Letâ€™s do some changes and commit them into the libraryâ€™s main branch.</p><pre><code>git add .
git commit -m 'access level fix'
</code></pre><p>Youâ€™re ready to use the lib in the app, change the main.swift file like this.</p><pre><code class="language-swift">import my_lib

print(my_lib().text)
</code></pre><p>Update the dependencies again, and letâ€™s do a release build this time.</p><pre><code>swift package update
swift build -c release
swift run -c release
</code></pre><p>With the <code>-c</code> or <code>--configuration</code> flag you can make a release build.</p><h3>Products and targets</h3><p>By default the SPM works with the following target directories:</p><p>Regular targets: package root, Sources, Source, src, srcs. Test targets: Tests, package root, Sources, Source, src, srcs.</p><p>This means, that if you create .swift files inside these folders, those sources will be compiled or tested, depending on the file location. Also the generated manifest file contains only one build target (like Xcode targets), but sometimes you want to create multiple apps or libraries from the same bundle. Letâ€™s change our Package.swift file a little bit, and see how can we make a brand new target.</p><pre><code class="language-swift">// swift-tools-version:5.2
import PackageDescription

let package = Package(
    name: "my-app",
    dependencies: [
        .package(url: "../my-lib", .branch("master")),
        .package(url: "https://github.com/kylef/Commander", from: "0.8.0"),
    ],
    targets: [
        .target(name: "my-app", dependencies: [
            .product(name: "my-lib", package: "my-lib"),
        ]),
        .target(name: "my-cmd", dependencies: [
            .product(name: "Commander", package: "Commander"),
        ], path: "./Sources/my-cmd", sources: ["main.swift"]),
    ]
)
</code></pre><p>We just created a new dependency from GitHub, and a brand new target which will contain only the <code>main.swift</code> file from the <code>Sources/my-cmd</code> directory. Now letâ€™s create this directory and add the source code for the new app.</p><pre><code class="language-swift">import Foundation
import Commander

let main = command { (name:String) in
    print("Hello, \(name.capitalized)!")
}

main.run()
</code></pre><p>Build the project with swift build and run the newly created app with one extra name parameter. Hopefully youâ€™ll see something like this.</p><pre><code>swift run my-cmd guest
# Hello, Guest!
</code></pre><p>So we just made a brand new executable target, however if youâ€™d like to expose your targets for other packages, you should define them as products as well. If you open the manifest file for the library, youâ€™ll see that there is a product defined from the library target. This way the package manager can link the product dependencies based on the given product name.</p><blockquote><p>NOTE: You can define static or dynamic libraries, however it is recommended to use automatic so the SPM can decide appropriate linkage.</p></blockquote><pre><code class="language-swift">// swift-tools-version:5.2
import PackageDescription

let package = Package(
    name: "my-lib-package",
    products: [
        .library(name: "my-lib", targets: ["my-lib"]),
        //.library(name: "my-lib", type: .static, targets: ["my-lib"]),
        //.library(name: "my-lib", type: .dynamic, targets: ["my-lib"]),
    ],
    dependencies: [
        // .package(url: /* package url */, from: "1.0.0"),
    ],
    targets: [
        .target(name: "my-lib", dependencies: []),
        .testTarget(name: "my-libTests", dependencies: ["my-lib"]),
    ]
)
</code></pre><h3>Deployment target, other build flags</h3><p>Sometimes youâ€™ll need to specify a deployment target for your package. Now this is possible with the Swift Package Manager (it was buggy <a href="https://oleb.net/blog/2017/04/swift-3-1-package-manager-deployment-target/" target="_blank">a log time ago</a>), you just have to provide some extra arguments for the compiler, during the build phase.</p><pre><code>swift build -Xswiftc "-target" -Xswiftc "x86_64-apple-macosx10.12"
</code></pre><p>Also if you would like to define build flags, thatâ€™s possible too.</p><pre><code>swift build -Xswiftc "-D" -Xswiftc "DEBUG"
</code></pre><p>Now in your source code you can check for the existence of the DEBUG flag.</p><pre><code class="language-swift">#if DEBUG
    print("debug mode")
#endif
</code></pre><p>If you want to know more about the build process, just type <code>swift build --help</code> and youâ€™ll see your available options for the build command.</p><p>This was SPM in a nutshell. Actually we have covered more than just the basics, we deep-dived a little into the Swift Package Manager, now you must be familiar with targets, products and most of the available commands, but there is always more to learn. So if you want to know even more about this amazing tool, you should check the Swift evolution dashboard for more info. ðŸ˜‰</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> Â·
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> Â·
                <a href="https://github.com/binarybirds/">GitHub</a> Â·
                <a href="https://x.com/tiborbodecs">Twitter</a> Â·
                <a href="/rss.xml" target="_blank">RSS</a> Â·
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
