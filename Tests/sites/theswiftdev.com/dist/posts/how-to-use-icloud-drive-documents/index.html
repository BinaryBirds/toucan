<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to use iCloud drive documents? - </title>
    <meta name="description" content="Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.">
    
    <meta property="og:url" content="/posts/how-to-use-icloud-drive-documents/">
    <meta property="og:title" content="How to use iCloud drive documents? - ">
    <meta property="og:description" content="Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to use iCloud drive documents? - ">
    <meta name="twitter:description" content="Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/about/">About</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2018-05-17 16:20:00">2018-05-17 16:20:00</time>
            <h1 class="title">How to use iCloud drive documents?</h1>
            <p class="excerpt">Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>iCloud drive project setup tutorial</h2><p>Let‚Äôs start by creating a new project for iOS. You can select the single view application template, don‚Äôt worry too much about document based apps, because in this tutorial we‚Äôre not going to touch the <code>UIDocument</code> class at all. ü§∑‚Äç‚ôÇÔ∏è</p><p><img src="capabilities.png" alt="Capabilities"></p><p>The first step is to enable iCloud capabilities, which will generate a new entitlements file for you. Also you‚Äôll have to enable the iCloud application service for the app id on the <a href="https://developer.apple.com/account/ios/identifier/bundle" target="_blank">Apple developer</a> portal. You should also assign the iCloud container that‚Äôs going to be used to store data. Just a few clicks, but you have to do this manually. üí©</p><blockquote><p>NOTE: You need a valid Apple Developer Program membership in order to set <a href="https://developer.apple.com/support/app-capabilities/" target="_blank">advanced app capabilities</a> like iCloud support. So you have to pay $99/year. #greed ü§ë</p></blockquote><p><img src="icloud.png" alt="iCloud"></p><p>So I believe that now you have a proper iOS app identifier with iCloud capabilities and application services enabled. One last step is ahead, you have to add these few lines to your <code>Info.plist</code> file in order to define the <a href="https://medium.com/ios-os-x-development/icloud-drive-documents-1a46b5706fe1" target="_blank">iCloud drive</a> container (folder name) that you‚Äôre going to use. Note that you can have multiple containers for one app.</p><pre><code class="language-xml"><key>NSUbiquitousContainers</key>
<dict>
    <key>iCloud.com.tiborbodecs.teszt</key>
    <dict>
        <key>NSUbiquitousContainerIsDocumentScopePublic</key>
        <true/>
        <key>NSUbiquitousContainerName</key>
        <string>Teszt</string>
        <key>NSUbiquitousContainerSupportedFolderLevels</key>
        <string>Any</string>
    </dict>
</dict>
</code></pre><p>Finally we‚Äôre ready to move forward with some actual coding. üíª</p><h2>Files inside iCloud drive containers</h2><p>Working with iCloud files using Swift is relatively easy. Basically you just have to get the base URL of your iCloud drive container, and you can do whatever you want. ü§î However I‚Äôll show you some best practices & tricks.</p><p>First you have to check if your container folder already exists, if not you should create it by hand using the FileManager class. I‚Äôve also made a ‚Äúshortcut‚Äù variable for the container base URL, so I don‚Äôt have to write all those long words again. üòÖ</p><pre><code class="language-swift">var containerUrl: URL? {
    FileManager.default.url(
        forUbiquityContainerIdentifier: nil
    )?.appendingPathComponent("Documents")
}
// check for container existence
if 
    let url = self.containerUrl, 
    !FileManager.default.fileExists(
        atPath: url.path, 
        isDirectory: nil
    ) {
    do {
        try FileManager.default.createDirectory(
            at: url, withIntermediateDirectories: true, 
            attributes: nil
        )
    }
    catch {
        print(error.localizedDescription)
    }
}
</code></pre><p>Working with paths inside the iCloud drive container is simple, you can append path components to the base URL and use that exact location URL as you want.</p><pre><code class="language-swift">let myDocumentUrl = self.containerUrl?
    .appendingPathComponent(subDirectory)
    .appendingPathComponent(fileName)
    .appendingPathExtension(fileExtension)
</code></pre><p>Picking existing files is also quite straightforward. You can use the built-in document picker class from UIKit. There are only two catches here. ü§¶‚Äç‚ôÇÔ∏è</p><p>First one is that you need to provide the type of the documents that you‚Äôd like to access. Have you ever heard about <a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_intro/understand_utis_intro.html#//apple_ref/doc/uid/TP40001319-CH201-SW1" target="_blank">UTI</a>‚Äôs? No? Maybe yes‚Ä¶? The thing is that you have to find the proper <a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_declare/understand_utis_declare.html#//apple_ref/doc/uid/TP40001319-CH204-SW1" target="_blank">uniform type identifier</a> for every file type, instead of providing an extension or mime-type or something commonly used thing. Smart one, huh? üß†</p><pre><code class="language-swift">let picker = UIDocumentPickerViewController(
    documentTypes: ["public.json"], 
    in: .open
)
picker.delegate = self
picker.modalPresentationStyle = .fullScreen
self.present(picker, animated: true, completion: nil)
</code></pre><p>The second catch is that you have to ‚Äúunlock‚Äù the picked file before you start reading it. That can be done by calling the <code>startAccessingSecurityScopedResource</code> method. Don‚Äôt forget to call the stopAccessingSecurityScopedResource method, or things are going to be out of balance. You don‚Äôt want that, trust me! #snap üß§</p><pre><code class="language-swift">func documentPicker(
    _ controller: UIDocumentPickerViewController, 
    didPickDocumentsAt urls: [URL]
) {
    guard
        controller.documentPickerMode == .open,
        let url = urls.first,
        url.startAccessingSecurityScopedResource()
    else {
        return
    }
    defer {
        url.stopAccessingSecurityScopedResource()
    }
    // do some work with the url
}
</code></pre><p>Everything else works as you‚Äôd expect. You can save files directly into the container through file APIs or by using the <code>UIDocumentPickerViewController</code> instance. Here are some of the most common api calls, that you can use to manipulate files.</p><pre><code class="language-swift">// string
try string.write(to: url, atomically: true, encoding: .utf8)
try String(contentsOf: url)

// data
try data.write(to: url, options: [.atomic])
try Data(contentsOf: url)

// file manager
FileManager.default.copyItem(at: local, to: url)
FileManager.default.removeItem(at: url)
</code></pre><p>You can read and write any kind of string, data. By using the <code>FileManager</code> you can copy, move, delete items or change file attributes. All your documents stored inside iCloud drive will be magically available on every device. Obviously you have to be logged in with your iCloud account, and have enough free storage. üí∞</p><h2>Debugging</h2><p>If you alter something in your settings you might want to increment your build number as well in order to notify the operating system about the changes. üí°</p><p>On the mac all the iCloud drive files / containers are located under the user‚Äôs Library folder inside the Mobile Documents directory. You can simply use the Terminal or Finder to go there and list all the files. Pro tip: look for hidden ones as well! üòâ</p><pre><code class="language-sh">cd ~/Library/Mobile\ Documents
ls -la
# ls -la|grep tiborbodecs
</code></pre><p>You can also monitor the activity of the CloudDocs daemon, by using this command:</p><pre><code class="language-sh"># man brctl
brctl log --wait --shorten
</code></pre><p>The output will tell you what‚Äôs actually happening during the sync.</p><p><img src="debug.png" alt="Debug"></p><p>I encourage you to check the manual entry for the <code>brctl</code> command, because there are a few more flags that can make troubleshooting more easy. ü§ê</p><p>This article was heavily inspired by <a href="https://x.com/krzyzanowskim" target="_blank">Marcin Krzyzanowski</a>‚Äôs really old blog post. üç∫</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
