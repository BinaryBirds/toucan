<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Mastering iOS auto layout anchors programmatically from Swift - </title>
    <meta name="description" content="Looking for best practices of using layout anchors? Let&#39;s learn how to use the iOS autolayout system in the proper way using Swift.">
    
    <meta property="og:url" content="/posts/mastering-ios-auto-layout-anchors-programmatically-from-swift/">
    <meta property="og:title" content="Mastering iOS auto layout anchors programmatically from Swift - ">
    <meta property="og:description" content="Looking for best practices of using layout anchors? Let&#39;s learn how to use the iOS autolayout system in the proper way using Swift.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mastering iOS auto layout anchors programmatically from Swift - ">
    <meta name="twitter:description" content="Looking for best practices of using layout anchors? Let&#39;s learn how to use the iOS autolayout system in the proper way using Swift.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2018-06-14 16:20:00">2018-06-14 16:20:00</time>
            <h1 class="title">Mastering iOS auto layout anchors programmatically from Swift</h1>
            <p class="excerpt">Looking for best practices of using layout anchors? Let&#39;s learn how to use the iOS autolayout system in the proper way using Swift.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>Creating views and constraints programmatically</h2><p>First of all I‚Äôd like to recap the <code>UIViewController</code> life cycle methods, you are might familiar with some of them. They are being called in the following order:</p><ul><li>loadView</li><li>viewDidLoad</li><li>viewWillAppear</li><li>viewWillLayoutSubviews</li><li>viewDidLayoutSubviews</li><li>viewDidAppear</li></ul><p>In the pre-auto layout era, you had to do your layout calculations inside the <code>viewDidLayoutSubviews</code> method, but since this is a <a href="https://theswiftdev.com/2017/10/31/ios-auto-layout-tutorial-programmatically/" target="_blank">pro auto layout tutorial</a> we are only going to focus on the <code>loadView</code> & <code>viewDidLoad</code> methods. ü§ì</p><p>These are the basic rules of creating view hierarchies using auto layout:</p><ul><li>Never calculate frames manually by yourself!</li><li>Initialize your views with `.zero` rect frame</li><li>Set `translatesAutoresizingMaskIntoConstraints` to false</li><li>Add your view to the view hierarchy using `addSubview`</li><li>Create and activate your layout constraints `NSLayoutConstraint.activate`</li><li>Use `loadView` instead of `viewDidLoad` for creating views with constraints</li><li>Take care of memory management by using weak properties</li><li>Set every other property like background color, etc. in `viewDidLoad`</li></ul><p>Enough theory, here is a short example:</p><pre><code class="language-swift">class ViewController: UIViewController {

    weak var testView: UIView!

    override func loadView() {
        super.loadView()

        let testView = UIView(frame: .zero)
        testView.translatesAutoresizingMaskIntoConstraints = false
        self.view.addSubview(testView)
        NSLayoutConstraint.activate([
            testView.widthAnchor.constraint(equalToConstant: 64),
            testView.widthAnchor.constraint(equalTo: testView.heightAnchor),
            testView.centerXAnchor.constraint(equalTo: self.view.centerXAnchor),
            testView.centerYAnchor.constraint(equalTo: self.view.centerYAnchor),
        ])
        self.testView = testView
    }

    override func viewDidLoad() {
        super.viewDidLoad()

        self.testView.backgroundColor = .red
    }
}
</code></pre><p>Pretty simple, huh? Just a few lines of code and you have a fixed size center aligned view with a dedicated class property reference. If you create the exact same through interface builder, the system will ‚Äúmake‚Äù you the <code>loadView</code> method for free, but you‚Äôll have to setup an <code>IBOutlet</code> reference to the view.</p><blockquote><p>The eternal dilemma: code vs Interface Builder.</p></blockquote><p>It really doesn‚Äôt matters, feel free to chose your path. Sometimes I love playing around with IB, but in most of the cases I prefer the programmatic way of doing things. üòõ</p><h2>Common UIKit auto layout constraint use cases</h2><p>So I promised that I‚Äôll show you how to make constraints programmatically, right? Let‚Äôs do that now. First of all, I use nothing but layout anchors. You could waste your time with the <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/VisualFormatLanguage.html" target="_blank">visual format language</a>, but that‚Äôs definitely a dead end. So mark my words: use only anchors or stack views, but nothing else! üòá</p><p>Here are the most common patterns that I use to create nice layouts. üòâ</p><h3>Set fixed with or height</h3><p>First one is the most simple one: set a view‚Äôs height or a width to a fixed point.</p><pre><code class="language-swift">testView.widthAnchor.constraint(equalToConstant: 320),
testView.heightAnchor.constraint(equalToConstant: 240),
</code></pre><h3>Set aspect ratio</h3><p>Settings a view‚Äôs aspect ratio is just constrainting the width to the height or vica versa, you can simply define the rate by the multiplier.</p><pre><code class="language-swift">testView.widthAnchor.constraint(equalToConstant: 64),
testView.widthAnchor.constraint(equalTo: testView.heightAnchor, multiplier: 16/9),
</code></pre><h3>Center horizontally & vertically</h3><p>Centering views inside another one is a trivial task, there are specific anchors for that.</p><pre><code class="language-swift">testView.centerXAnchor.constraint(equalTo: self.view.centerXAnchor),
testView.centerYAnchor.constraint(equalTo: self.view.centerYAnchor),
</code></pre><h3>Stretch or fill inside view with padding</h3><p>The only tricky part here is that trailing and bottom constraints behave a little bit different, than top & leading if it comes to the constants. Usually you have to work with negative values, but after a few tries you‚Äôll understand the logic here. üòÖ</p><pre><code class="language-swift">testView.topAnchor.constraint(equalTo: self.view.topAnchor, constant: 32),
testView.leadingAnchor.constraint(equalTo: self.view.leadingAnchor, constant: 32),
testView.trailingAnchor.constraint(equalTo: self.view.trailingAnchor, constant: -32),
testView.bottomAnchor.constraint(equalTo: self.view.bottomAnchor, constant: -32),
</code></pre><h3>Proportional width or height</h3><p>If you don‚Äôt want to work with constant values, you can use the multiplier.</p><pre><code class="language-swift">testView.widthAnchor.constraint(equalTo: self.view.widthAnchor, multiplier: 1/3),
testView.heightAnchor.constraint(equalTo: self.view.heightAnchor, multiplier: 2/3),
</code></pre><h3>Using safe area layout guides</h3><p>With the latest iPhone you‚Äôll need some guides in order to keep you safe from the notch. This is the reason why views have the safeAreaLayoutGuide property. You can get all the usual anchors after calling out to the safe area guide. üí™</p><pre><code class="language-swift">testView.topAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.topAnchor),
testView.leadingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.leadingAnchor),
testView.trailingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.trailingAnchor),
testView.bottomAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.bottomAnchor),
</code></pre><h2>Animating layout constraints</h2><p>Animation with constraints is easy, you shouldn‚Äôt believe what others might say. I made some rules and an example that‚Äôll help you understanding the basic principles of animating constant values of a constraint, plus toggling various constraints. üëç</p><p>Rules:</p><ul><li>Use standard UIView animation with layoutIfNeeded</li><li>Always deactivate constraints first</li><li>Hold to your deactivated constraints strongly</li><li>Have fun! üòõ</li></ul><p>Constraint animation example:</p><pre><code class="language-swift">class ViewController: UIViewController {

    weak var testView: UIView!
    weak var topConstraint: NSLayoutConstraint!
    var bottomConstraint: NSLayoutConstraint!
    var heightConstraint: NSLayoutConstraint!

    override func loadView() {
        super.loadView()

        let testView = UIView(frame: .zero)
        testView.translatesAutoresizingMaskIntoConstraints = false
        self.view.addSubview(testView)

        let topConstraint = testView.topAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.topAnchor)
        let bottomConstraint = testView.bottomAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.bottomAnchor)

        NSLayoutConstraint.activate([
            topConstraint,
            testView.leadingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.leadingAnchor),
            testView.trailingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.trailingAnchor),
            bottomConstraint,
        ])

        let heightConstraint = testView.heightAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.heightAnchor, multiplier: 0.5)

        self.testView = testView
        self.topConstraint = topConstraint
        self.bottomConstraint = bottomConstraint
        self.heightConstraint = heightConstraint
    }

    override func viewDidLoad() {
        super.viewDidLoad()

        self.testView.backgroundColor = .red

        let tap = UITapGestureRecognizer(target: self, action: #selector(self.tapped))
        self.view.addGestureRecognizer(tap)
    }

    @objc func tapped() {
        if self.topConstraint.constant != 0 {
            self.topConstraint.constant = 0
        }
        else {
            self.topConstraint.constant = 64
        }

        if self.bottomConstraint.isActive {
            NSLayoutConstraint.deactivate([self.bottomConstraint])
            NSLayoutConstraint.activate([self.heightConstraint])

        }
        else {
            NSLayoutConstraint.deactivate([self.heightConstraint])
            NSLayoutConstraint.activate([self.bottomConstraint])
        }

        UIView.animate(withDuration: 0.25) {
            self.view.layoutIfNeeded()
        }
    }
}
</code></pre><p>It‚Äôs not that bad, next: <a href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/adaptivity-and-layout/" target="_blank">adaptivity</a> and supporting multiple device screen sizes. ü§î</p><p>How to create adaptive layouts for iOS?<br>Even Apple is struggling with adaptive layouts in the built-in iOS applications. If you look at apps that are made with collection views - like photos - layouts are pretty okay on every device. However there are a few other ones, that - in my opinion - are horrible experiences on a bigger screen. ü§ê</p><h3>Rotation support</h3><p>Your first step to adaptive layout is supporting multiple device orientations. You can check my previous article about <a href="https://theswiftdev.com/2017/10/31/ios-auto-layout-tutorial-programmatically/" target="_blank">iOS auto layout</a> there are lots of great stuff inside that article about rotation support, working with layers inside auto layout land, etc. üåà</p><h3>Trait collections</h3><p>Second step is to adapt trait collections. <a href="https://developer.apple.com/documentation/uikit/uitraitcollection" target="_blank">UITraitCollection</a> is there for you to group all the environmental specific traits such as size classes, display scale, user interface idiom and many more. Most of the times you will have to check the vertical & horizontal size classes. There is a reference of device size classes and all the possible variations made by Apple, see the external sources section below. üòâ</p><p>This little Swift code example below is demonstrating how to check size classes for setting different layouts for compact and regular screens.</p><pre><code class="language-swift">class ViewController: UIViewController {

    weak var testView: UIView!

    var regularConstraints: [NSLayoutConstraint] = []
    var compactConstraints: [NSLayoutConstraint] = []

    override func loadView() {
        super.loadView()

        let testView = UIView(frame: .zero)
        testView.translatesAutoresizingMaskIntoConstraints = false
        self.view.addSubview(testView)

        self.regularConstraints = [
            testView.widthAnchor.constraint(equalToConstant: 64),
            testView.widthAnchor.constraint(equalTo: testView.heightAnchor),
            testView.centerXAnchor.constraint(equalTo: self.view.centerXAnchor),
            testView.centerYAnchor.constraint(equalTo: self.view.centerYAnchor),
        ]

        self.compactConstraints = [
            testView.topAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.topAnchor),
            testView.leadingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.leadingAnchor),
            testView.trailingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.trailingAnchor),
            testView.bottomAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.bottomAnchor),
        ]

        self.activateCurrentConstraints()

        self.testView = testView
    }

    private func activateCurrentConstraints() {
        NSLayoutConstraint.deactivate(self.compactConstraints + self.regularConstraints)

        if self.traitCollection.verticalSizeClass == .regular {
            NSLayoutConstraint.activate(self.regularConstraints)
        }
        else {
            NSLayoutConstraint.activate(self.compactConstraints)
        }
    }

    override func viewDidLoad() {
        super.viewDidLoad()

        self.testView.backgroundColor = .red
    }

    // MARK: - rotation support

    override var shouldAutorotate: Bool {
        return true
    }

    override var supportedInterfaceOrientations: UIInterfaceOrientationMask {
        return .allButUpsideDown
    }

    override var preferredInterfaceOrientationForPresentation: UIInterfaceOrientation {
        return .portrait
    }

    // MARK: - trait collections

    override func traitCollectionDidChange(_ previousTraitCollection: UITraitCollection?) {
        super.traitCollectionDidChange(previousTraitCollection)

        self.activateCurrentConstraints()
    }
}
</code></pre><h3>Device detection</h3><p>You can also check the user interface idiom through the <code>UIDevice</code> class (aka. is this freakin‚Äô device an iPhone or an iPad?) to set for example font sizes based on it. üì±</p><pre><code class="language-swift">UIDevice.current.userInterfaceIdiom == .pad
</code></pre><h3>Screen size</h3><p>Another option to figure out your environment is checking the <a href="https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions" target="_blank">size of the screen</a>. You can check the native pixel count or a relative <a href="https://www.kylejlarson.com/blog/ipad-screen-size-guide-web-design-tips/" target="_blank">size</a> based in points.</p><pre><code class="language-swift">//iPhone X
UIScreen.main.nativeBounds   // 1125x2436
UIScreen.main.bounds         // 375x812
</code></pre><p>Usually I‚Äôm trying to keep myself to these rules. I don‚Äôt really remember a scenario where I needed more than all the things I‚Äôve listed above, but if you have a specific case or questions, please don‚Äôt hesitate to contact me. üòâ</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
