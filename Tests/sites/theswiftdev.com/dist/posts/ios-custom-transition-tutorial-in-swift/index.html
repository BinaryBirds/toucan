<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>iOS custom transition tutorial in Swift - </title>
    <meta name="description" content="In this tutorial, you&#39;ll learn how to replace the push, pop and modal animations with custom transitions &amp; percent driven interactions.">
    
    <meta property="og:url" content="/posts/ios-custom-transition-tutorial-in-swift/">
    <meta property="og:title" content="iOS custom transition tutorial in Swift - ">
    <meta property="og:description" content="In this tutorial, you&#39;ll learn how to replace the push, pop and modal animations with custom transitions &amp; percent driven interactions.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="iOS custom transition tutorial in Swift - ">
    <meta name="twitter:description" content="In this tutorial, you&#39;ll learn how to replace the push, pop and modal animations with custom transitions &amp; percent driven interactions.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2018-04-26 16:20:00">2018-04-26 16:20:00</time>
            <h1 class="title">iOS custom transition tutorial in Swift</h1>
            <p class="excerpt">In this tutorial, you&#39;ll learn how to replace the push, pop and modal animations with custom transitions &amp; percent driven interactions.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>UIKit custom transition API - a theoretical lesson</h2><p>There are many classes and delegates involved during the process of making a <a href="https://developer.apple.com/videos/play/wwdc2013/218/" target="_blank">custom transition</a>, let‚Äôs walk through these items real quick, and do some coding afterwards.</p><h3>UIViewControllerTransitioningDelegate</h3><p>Every view controller can have a transition delegate, in that delegate implementation you can provide the custom animation and interaction controllers. Those objects will be responsible for the actual animation process, and this delegate is the place where you can ‚Äúinject your code‚Äù to the UIKit framework. üíâ</p><h3>UINavigationControllerDelegate</h3><p>The navigation controller delegate also has two methods that are responsible for custom push and pop <a href="https://stackoverflow.com/questions/26569488/navigation-controller-custom-transition-animation" target="_blank">animations</a>. It‚Äôs almost the same as the transitioning delegate for the view controllers, but you‚Äôll see this in action later on. üí•</p><h3>UINavigationController.Operation</h3><p>The navigation controller operation is just an <code>enum</code> which contains the ‚Äúdirection‚Äù of the navigation animation. Usually push or pop.</p><blockquote><p>NOTE: Presenting and dismissing something modally is not exactly the same thing as pushing & popping view controllers inside a navigation stack. More on this later.</p></blockquote><h3>UIViewControllerAnimatedTransitioning</h3><p>These objects are returned by the transition delegate, so basically this is the place where you implement the fancy custom view animations. üòâ</p><h3>UIViewControllerContextTransitioning</h3><p>This context encapsulates all the info about the transitioning, you can get the participating views, controllers and many more from this object. The transitioning context is available for you to use it during the animation.</p><h3>UIPercentDrivenInteractiveTransition</h3><p>An object that drives an interactive animation between one view controller and another.</p><p>In a nutshell, this is the thing that gives you the magical ability to swipe a navigation controller interactively back (and forth if you changed your mind) with your fingers from the edge of the screen. üì±</p><h2>Custom transition animations programmatically</h2><p>Let‚Äôs do some real coding! I‚Äôll show you how to make a basic fade <a href="https://www.raywenderlich.com/170144/custom-uiviewcontroller-transitions-getting-started" target="_blank">animation between view controllers</a> inside a navigation stack. First we‚Äôll start with the push animation.</p><pre><code class="language-swift">open class FadePushAnimator: NSObject, UIViewControllerAnimatedTransitioning {

    open func transitionDuration(
        using transitionContext: UIViewControllerContextTransitioning?
    ) -> TimeInterval {
        0.5
    }

    open override func animateTransition(
        using transitionContext: UIViewControllerContextTransitioning
    ) {
        guard
            let toViewController = transitionContext.viewController(forKey: .to)
        else {
            return
        }
        transitionContext.containerView.addSubview(toViewController.view)
        toViewController.view.alpha = 0

        let duration = self.transitionDuration(using: transitionContext)
        UIView.animate(withDuration: duration, animations: {
            toViewController.view.alpha = 1
        }, completion: { _ in
            transitionContext.completeTransition(
                !transitionContext.transitionWasCancelled
            )
        })
    }
}
</code></pre><p>As you can see creating a custom transition animation is really simple. You just have to implement two delegate methods. One of them will return the duration of the animation, and the other will contain the actual transition.</p><p>The transition context provides a custom <code>containterView</code> object that you can use in the animation, also you can grab the participating views and controllers from this object as I mentioned it before. Now let‚Äôs reverse this animation. üëà</p><pre><code class="language-swift">open class FadePopAnimator: CustomAnimator {

    open func transitionDuration(
        using transitionContext: UIViewControllerContextTransitioning?
    ) -> TimeInterval {
        0.5
    }

    open override func animateTransition(
        using transitionContext: UIViewControllerContextTransitioning
    ) {
        guard
            let fromViewController = transitionContext.viewController(forKey: .from),
            let toViewController = transitionContext.viewController(forKey: .to)
        else {
            return
        }

        transitionContext.containerView.insertSubview(toViewController.view, belowSubview: fromViewController.view)

        let duration = self.transitionDuration(using: transitionContext)
        UIView.animate(withDuration: duration, animations: {
            fromViewController.view.alpha = 0
        }, completion: { _ in
            transitionContext.completeTransition(
                !transitionContext.transitionWasCancelled
            )
        })
    }
}
</code></pre><p>Finally you just have to implement the navigation controller‚Äôs delegate method in order to replace the built-in UIKit system animations. üõ†</p><pre><code class="language-swift">extension MainViewController: UINavigationControllerDelegate {

    func navigationController(
        _ navigationController: UINavigationController,
        animationControllerFor operation: UINavigationController.Operation,
        from fromVC: UIViewController,
        to toVC: UIViewController
    ) -> UIViewControllerAnimatedTransitioning? {
        switch operation {
        case .push:
            return FadePushAnimator()
        case .pop:
            return FadePopAnimator()
        default:
            return nil
        }
    }
}
</code></pre><p>Note that you don‚Äôt have to make two separate classes (pop & push), you can also pass the operation and implement the animations in a single animated transitioning class.</p><p>Percent driven interactive transitions<br>So, now you know how to implement a custom transition, but it‚Äôs time to make it interactive! The process is pretty simple, you‚Äôll only need a gesture recognizer and a proper delegate method to make things work. ‚å®Ô∏è</p><pre><code class="language-swift">class DetailViewController: UIViewController {

    var interactionController: UIPercentDrivenInteractiveTransition?

    override func viewDidLoad() {
        super.viewDidLoad()

        self.view.backgroundColor = .lightGray

        let edge = UIScreenEdgePanGestureRecognizer(
            target: self,
            action: #selector(self.handleEdgePan(_:))
        )
        edge.edges = .left
        self.view.addGestureRecognizer(edge)
    }

    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)

        self.navigationController?.delegate = self
    }

    @objc func handleEdgePan(_ gesture: UIScreenEdgePanGestureRecognizer) {
        let translate = gesture.translation(in: gesture.view)
        let percent = translate.x / gesture.view!.bounds.size.width

        switch gesture.state {
        case .began:
            self.interactionController = UIPercentDrivenInteractiveTransition()
            self.navigationController?.popViewController(animated: true)
        case .changed:
            self.interactionController?.update(percent)
        case .ended:
            let velocity = gesture.velocity(in: gesture.view)

            if percent &gt; 0.5 || velocity.x &gt; 0 {
                self.interactionController?.finish()
            }
            else {
                self.interactionController?.cancel()
            }
            self.interactionController = nil
        default:
            break
        }
    }
}

extension DetailViewController: UINavigationControllerDelegate {

    /* ... */

    func navigationController(
        _ navigationController: UINavigationController,
        interactionControllerFor animationController: UIViewControllerAnimatedTransitioning
    ) -> UIViewControllerInteractiveTransitioning? {
        interactionController
    }
}
</code></pre><p>Inside the controller that will be popped you can take ownership of the navigation controller‚Äôs delegate and implement the interactive transition controller using a left screen edge pan gesture recognizer. This whole code usually goes into a new subclass of <code>UIPercentDrivenInteractiveTransition</code> but for the sake of simplicity this time we‚Äôll skip that, and go with this really easy solution. In the <a href="https://gitlab.com/theswiftdev/custom-transitions" target="_blank">final example code</a> you‚Äôll find the ‚Äúsubclassed version‚Äù of the interactive transition. üòÖ</p><h2>Navigation vs modal presentation</h2><p>Ok, let‚Äôs cover one more thing real quick: customizing <a href="https://github.com/pronebird/CustomModalTransition" target="_blank">modal</a> presentation animations for view controllers. There is a minor difference between customizing the navigation stack animations and modal presentation styles. If you want to customize a view controller transition you‚Äôd usually do something like this. üëç</p><pre><code class="language-swift">class DetailViewController: UIViewController {

     /* ... */

    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        super.prepare(for: segue, sender: sender)

        guard let controller = segue.destination as? ModalViewController else {
            return
        }

        controller.transitioningDelegate = self
        controller.modalPresentationStyle = .custom
        controller.modalPresentationCapturesStatusBarAppearance = true
    }
}
Here comes the transitioning delegate, using the same objects that we already have.

extension DetailViewController: UIViewControllerTransitioningDelegate {

    func animationController(forPresented presented: UIViewController,
                             presenting: UIViewController,
                             source: UIViewController) -> UIViewControllerAnimatedTransitioning? {
        return FadePushAnimator()
    }

    func animationController(forDismissed dismissed: UIViewController) -> UIViewControllerAnimatedTransitioning? {
        return FadePopAnimator()
    }
}
</code></pre><p>If you run the code and present the modal view controller, that‚Äôll work just fine. The problem occurs when you try to dismiss the presented view controller. The whole app will turn to a <a href="https://stackoverflow.com/questions/28558882/custom-transition-results-in-black-screen-or-unresponsive-screen" target="_blank">black screen</a> of death (<a href="https://en.wikipedia.org/wiki/Blue_Screen_of_Death" target="_blank">BSOD</a>). üñ•</p><blockquote><p>(pop != dismiss) && (push != present)</p></blockquote><p>You have to modify the pop animation in order to support modal dismissal animations. In short: the problem is with placing views and memory management.</p><pre><code class="language-swift">open class FadePopAnimator: NSObject, UIViewControllerAnimatedTransitioning {

    public enum TransitionType {
        case navigation
        case modal
    }

    let type: TransitionType
    let duration: TimeInterval

    public init(type: TransitionType, duration: TimeInterval = 0.25) {
        self.type = type
        self.duration = duration

        super.init()
    }

    open func transitionDuration(using transitionContext: UIViewControllerContextTransitioning?) -> TimeInterval {
        return self.duration
    }

    open override func animateTransition(using transitionContext: UIViewControllerContextTransitioning) {
        guard
            let fromViewController = transitionContext.viewController(forKey: .from)
        else {
            return
        }

        if self.type == .navigation, let toViewController = transitionContext.viewController(forKey: .to) {
            transitionContext.containerView.insertSubview(toViewController.view, belowSubview: fromViewController.view)
        }

        let duration = self.transitionDuration(using: transitionContext)
        UIView.animate(withDuration: duration, animations: {
            fromViewController.view.alpha = 0
        }, completion: { _ in
            transitionContext.completeTransition(!transitionContext.transitionWasCancelled)
        })
    }
}
</code></pre><p>The most simple solution is to introduce a new property so you can make a decision to pop or dismiss the view controller based on that flag. Now you can safely use the same animators for modally presented view controllers as well. üò¨</p><p>The sample code is inside The.Swift.Dev. <a href="https://github.com/theswiftdev/tutorials" target="_blank">tutorials</a> repository, you‚Äôll find examples for replacing the <a href="https://gist.github.com/alanzeino/603293f9da5cd0b7f6b60dc20bc766be" target="_blank">default</a> push & pop navigation animations with custom ones.</p><p>Note that the navigation bar will always use a fade animation, unfortunately that can not be customized. Also I‚Äôve made a custom modal presentation, and everything is using the interactive transitions too. Obviously there is a lot more, but below are some links that you can follow if you hit an obstacle during your journey.</p><p>Also if you don‚Äôt want to manually implement custom animation effects you can use <a href="https://github.com/lkzhao/Hero" target="_blank">Hero</a> the elegant transition <a href="https://github.com/carguezu/CGZTransitions" target="_blank">library</a>.</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
