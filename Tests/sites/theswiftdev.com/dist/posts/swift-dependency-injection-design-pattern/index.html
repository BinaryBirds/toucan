<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Swift dependency injection design pattern - </title>
    <meta name="description" content="Want to learn the Dependency Injection pattern using Swift? This tutorial will show you how to write loosely coupled code using DI.">
    
    <meta property="og:url" content="/posts/swift-dependency-injection-design-pattern/">
    <meta property="og:title" content="Swift dependency injection design pattern - ">
    <meta property="og:description" content="Want to learn the Dependency Injection pattern using Swift? This tutorial will show you how to write loosely coupled code using DI.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Swift dependency injection design pattern - ">
    <meta name="twitter:description" content="Want to learn the Dependency Injection pattern using Swift? This tutorial will show you how to write loosely coupled code using DI.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2018-07-17 16:20:00">2018-07-17 16:20:00</time>
            <h1 class="title">Swift dependency injection design pattern</h1>
            <p class="excerpt">Want to learn the Dependency Injection pattern using Swift? This tutorial will show you how to write loosely coupled code using DI.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <p>First of all I really like this little quote by James Shore:</p><blockquote><p>Dependency injection means giving an object its instance variables. Really. That‚Äôs it.</p></blockquote><p>In my opinion the whole story is just a little bit more complicated, but if you tear down the problem to the roots, you‚Äôll realize that implementing the <a href="http://ilya.puchka.me/dependency-injection-in-swift/" target="_blank">DI pattern</a> can be as simple as giving an object instance variables. No kidding, it‚Äôs really a no-brainer, but many developers are over complicating it and using injections at the wrong places. üíâ</p><p>Learning <a href="https://clean-swift.com/advanced-dependency-injection/" target="_blank">DI</a> is not about the implementation details, it‚Äôs all about how are you going to use the pattern. There are four little variations of dependency injection, let‚Äôs go through them by using real world examples that‚Äôll help you to get an idea about when to use dependency injection. Now grab your keyboards! üíª</p><h2>Dependency Injection basics</h2><p>As I mentioned before DI is a fancy term for a simple concept, you don‚Äôt really need external libraries or frameworks to start using it. Let‚Äôs imagine that you have two separate objects. Object A wants to use object B. Say hello to your first dependency.</p><p>If you hardcode object B into object A that‚Äôs not going to be good, because from that point A can not be used without B. Now scale this up to a ~100 object level. If you don‚Äôt do something with this problem you‚Äôll have a nice bowl of spaghetti. üçù</p><p>So the main goal is to create independent objects as much as possible or some say loosely coupled code, to improve reusability and testability. Separation of concerns and decoupling are right terms to use here too, because in most of the cases you should literally separate logical functionalities into standalone objects. ü§ê</p><p>So in theory both objects should do just one specific thing, and the dependency between them is usually realized through a common descriptor (protocol), without hardcoding the exact instances. Using <a href="http://www.jamesshore.com/Blog/Dependency-Injection-Demystified.html" target="_blank">dependency injection</a> for this purpose will improve your code quality, because dependencies can be replaced without changing the other object‚Äôs implementation. That‚Äôs good for mocking, testing, reusing <a href="https://cocoacasts.com/nuts-and-bolts-of-dependency-injection-in-swift" target="_blank">etc</a>. üòé</p><h2>How to do DI in Swift?</h2><p>Swift is an amazing programming language, with excellent support for both protocol and object oriented principles. It also has great functional capabilities, but let‚Äôs ignore that for now. Dependency injection can be done in <a href="https://www.swiftbysundell.com/posts/different-flavors-of-dependency-injection-in-swift" target="_blank">multiple ways</a>, but in this tutorial I‚Äôll focus on just a few basic ones without any external dependency injection. üòÇ</p><p>Well, let‚Äôs start with a protocol, but that‚Äôs just because Swift is not exposing the <code>Encoder</code> for the public, but we‚Äôll need something like that for the demos.</p><pre><code class="language-swift">protocol Encoder {
    func encode<T>(_ value: T) throws -> Data where T: Encodable
}
extension JSONEncoder: Encoder { }
extension PropertyListEncoder: Encoder { }
</code></pre><p>Property list and JSON encoders already implement this method we‚Äôll only need to extend our objects to comply for our brand new protocol.</p><h2>Constructor injection</h2><p>The most common form of dependency injection is constructor injection or initializer-based injection. The idea is that you pass your dependency through the initializer and store that object inside a (private read-only / immutable) property variable. The main benefit here is that your object will have every dependency - by the time it‚Äôs being created - in order to work properly. üî®</p><pre><code class="language-swift">class Post: Encodable {

    var title: String
    var content: String

    private var encoder: Encoder

    private enum CodingKeys: String, CodingKey {
        case title
        case content
    }

    init(title: String, content: String, encoder: Encoder) {
        self.title = title
        self.content = content
        self.encoder = encoder
    }

    func encoded() throws -> Data {
        return try self.encoder.encode(self)
    }
}

let post = Post(title: "Hello DI!", content: "Constructor injection", encoder: JSONEncoder())

if let data = try? post.encoded(), let encoded = String(data: data, encoding: .utf8) {
    print(encoded)
}
</code></pre><p>You can also give a default value for the encoder in the constructor, but you should fear the <strong>bastard injection anti-pattern</strong>! That means if the default value comes from another module, your code will be tightly coupled with that one. So think twice! ü§î</p><h2>Property injection</h2><p>Sometimes initializer injection is hard to do, because your class have to inherit from a system class. This makes the process really hard if you have to work with views or controllers. A good solution for this situation is to use a property-based injection design pattern. Maybe you can‚Äôt have full control over initialization, but you can always control your properties. The only disadvantage is that you have to check if that property is already presented (being set) or not, before you do anything with it. ü§´</p><pre><code class="language-swift">class Post: Encodable {

    var title: String
    var content: String

    var encoder: Encoder?

    private enum CodingKeys: String, CodingKey {
        case title
        case content
    }

    init(title: String, content: String) {
        self.title = title
        self.content = content
    }

    func encoded() throws -> Data {
        guard let encoder = self.encoder else {
            fatalError("Encoding is only supported with a valid encoder object.")
        }
        return try encoder.encode(self)
    }
}

let post = Post(title: "Hello DI!", content: "Property injection")
post.encoder = JSONEncoder()

if let data = try? post.encoded(), let encoded = String(data: data, encoding: .utf8) {
    print(encoded)
}
</code></pre><p>There are lots of property injection patterns in iOS frameworks, <a href="https://theswiftdev.com/2018/06/27/swift-delegate-design-pattern/" target="_blank">delegate patterns</a> are often implemented like this. Also another great benefit is that these properties can be mutable ones, so you can replace them on-the-fly. ‚úàÔ∏è</p><h2>Method injection</h2><p>If you need a dependency only once, you don‚Äôt really need to store it as an object variable. Instead of an initializer argument or an exposed mutable property, you can simply pass around your dependency as a method parameter, this technique is called method injection or some say parameter-based injection. üëç</p><pre><code class="language-swift">class Post: Encodable {

    var title: String
    var content: String

    init(title: String, content: String) {
        self.title = title
        self.content = content
    }

    func encode(using encoder: Encoder) throws -> Data {
        return try encoder.encode(self)
    }
}

let post = Post(title: "Hello DI!", content: "Method injection")

if let data = try? post.encode(using: JSONEncoder()), let encoded = String(data: data, encoding: .utf8) {
    print(encoded)
}
</code></pre><p>Your dependency can vary each time this method gets called, it‚Äôs not required to keep a reference from the dependency, so it‚Äôs just going to be used in a local method scope.</p><h2>Ambient context</h2><p>Our last pattern is quite a dangerous one. It should be used only for universal dependencies that are being shared alongside multiple object instances. Logging, analytics or a caching mechanism is a good example for this. üöß</p><pre><code class="language-swift">class Post: Encodable {

    var title: String
    var content: String

    init(title: String, content: String) {
        self.title = title
        self.content = content
    }

    func encoded() throws -> Data {
        return try Post.encoder.encode(self)
    }


    private static var _encoder: Encoder = PropertyListEncoder()

    static func setEncoder(_ encoder: Encoder) {
        self._encoder = encoder
    }

    static var encoder: Encoder {
        return Post._encoder
    }
}

let post = Post(title: "Hello DI!", content: "Ambient context")
Post.setEncoder(JSONEncoder())

if let data = try? post.encoded(), let encoded = String(data: data, encoding: .utf8) {
    print(encoded)
}
</code></pre><p>Ambient context has some disadvantages. It might fits well in case of cross-cutting concerns, but it creates implicit dependencies and represents a global mutable state. It‚Äôs not highly recommended, you should consider the other dependency injection patterns first, but sometimes it can be a right fit for you.</p><p>That‚Äôs all about dependency injection patterns in a nutshell. If you are looking for more, you should read the following sources, because they‚Äôre all amazing. Especially the first one by <a href="https://x.com/ilyapuchka" target="_blank">Ilya Puchka</a>, that‚Äôs highly recommended. üòâ</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
